version: 2.1
orbs:
  coveralls: coveralls/coveralls@1.0.6
jobs:
  build:
    docker:
      - image: circleci/php:7.4-node-browsers
    steps:
      - checkout
      - run: sudo apt update
      - run: composer install -n
      - run: composer require --dev php-coveralls/php-coveralls
      - run: ./vendor/bin/psalm
      - run: XDEBUG_MODE=coverage ./vendor/bin/phpunit --config=phpunit.dist.xml
      - run: ./vendor/bin/php-coveralls -x ./reports/coverage.xml -o ./reports/coveralls.yml
      - coveralls/upload:
          flag_name: "Unit Tests"
          path_to_lcov: ./reports/coverage.yml
