version: 2.1
jobs:
  build:
    docker:
      - image: cimg/php:7.4
    steps:
      - checkout
      - run:
          name: "System Setup"
          command: |
              sudo apt update
              sudo apt install php-xdebug
              sudo mkdir -p /usr/local/etc/php/conf.d
              echo "zend_extension=xdebug.so" | sudo tee -a /usr/local/etc/php/conf.d/xdebug.ini
      - run:
          name: "Composer Install"
          command: |
              composer install -n
              composer require --dev php-coveralls/php-coveralls
      - run:
          name: "Code Quality"
          command: |
              ./vendor/bin/psalm
      - run:
          name: "Unit Tests"
          command: |
              XDEBUG_MODE=coverage ./vendor/bin/phpunit --config=phpunit.xml.dist
              ./vendor/bin/php-coveralls
workflows:
  version: 2
  build:
    jobs:
      - build
